<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Mobile Field - Database Check</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-ok { color: #10b981; }
        .status-error { color: #ef4444; }
        pre { background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold mb-6">Database Mobile Field Verification</h1>
            
            <button 
                id="checkBtn"
                class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors mb-6"
                onclick="checkDatabase()"
            >
                Check Database
            </button>
            
            <div id="loading" class="hidden">
                <div class="flex items-center gap-2 text-blue-600">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                    <span>Checking database...</span>
                </div>
            </div>
            
            <div id="results" class="hidden">
                <h2 class="text-xl font-semibold mb-4">Results:</h2>
                
                <div class="mb-6 p-4 rounded-lg" id="statusBox">
                    <h3 class="font-semibold mb-2">Mobile Column Status:</h3>
                    <p id="statusText"></p>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Database Details:</h3>
                    <pre id="details"></pre>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Sample Users:</h3>
                    <pre id="users"></pre>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">All Columns in Users Table:</h3>
                    <pre id="columns"></pre>
                </div>
                
                <div id="fixInstructions" class="hidden bg-yellow-50 border border-yellow-200 p-4 rounded-lg">
                    <h3 class="font-semibold text-yellow-800 mb-2">⚠️ Mobile Column Missing!</h3>
                    <p class="mb-2">To fix this issue, run the following SQL script:</p>
                    <ol class="list-decimal list-inside space-y-1 text-sm">
                        <li>Open phpMyAdmin or MySQL client</li>
                        <li>Select your database (SAHANALK)</li>
                        <li>Go to SQL tab</li>
                        <li>Run the file: <code class="bg-yellow-100 px-2 py-1 rounded">setup/database/add_mobile_column.sql</code></li>
                        <li>Or run this command directly:</li>
                    </ol>
                    <pre class="mt-2 text-xs">ALTER TABLE users ADD COLUMN mobile VARCHAR(20) DEFAULT NULL AFTER email;</pre>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        async function checkDatabase() {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const checkBtn = document.getElementById('checkBtn');
            
            loading.classList.remove('hidden');
            results.classList.add('hidden');
            checkBtn.disabled = true;
            
            try {
                const response = await fetch('verify-database.php');
                const data = await response.json();
                
                const statusBox = document.getElementById('statusBox');
                const statusText = document.getElementById('statusText');
                const fixInstructions = document.getElementById('fixInstructions');
                
                if (data.mobile_column_exists) {
                    statusBox.classList.add('bg-green-50', 'border', 'border-green-200');
                    statusText.innerHTML = '<span class="status-ok">✅ Mobile column exists in database!</span>';
                    statusText.innerHTML += '<br><small>Data Type: ' + data.mobile_column_details.DATA_TYPE + '</small>';
                    fixInstructions.classList.add('hidden');
                } else {
                    statusBox.classList.add('bg-red-50', 'border', 'border-red-200');
                    statusText.innerHTML = '<span class="status-error">❌ Mobile column is MISSING from database!</span>';
                    fixInstructions.classList.remove('hidden');
                }
                
                document.getElementById('details').textContent = JSON.stringify({
                    database: data.database_name,
                    mobile_column: data.mobile_column_details
                }, null, 2);
                
                document.getElementById('users').textContent = JSON.stringify(data.sample_users, null, 2);
                document.getElementById('columns').textContent = JSON.stringify(data.all_columns, null, 2);
                
                results.classList.remove('hidden');
            } catch (error) {
                alert('Error checking database: ' + error.message);
            } finally {
                loading.classList.add('hidden');
                checkBtn.disabled = false;
            }
        }
        
        // Auto-check on load
        window.addEventListener('load', checkDatabase);
    </script>
</body>
</html>



